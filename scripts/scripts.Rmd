---
title: "Motif Analysis - sliding window"
output:
  html_document:
    number_sections: true
    toc: true
    toc_depth: 3
    toc_float: true
date: "`r format(Sys.time(), '%B %d, %Y')`"
---
  
```{r}
ntrials <- 1000
nrepeats <- 100

hat.cor.b <- c()
for(r in 1 : nrepeats) {
  # print(i)
  b1.hat <- c()
  b2.hat <- c()
  for(i in 1 : ntrials) {
    # z2 = a * z1 + e0
    # y = b1 * z1 + e1
    # y = b2 * z2 + e2
    
    a <- 1 
    b1 <- 2
    n <- 100
    var.e0 <- 1e-5
    var.e1 <- 1e-2
    var.z1 <- 1e-2
    cor.z <- a * var.z1 / sqrt(var.z1 * (a ^ 2 * var.z1 + var.e0))
    
    z1 <- rnorm(n, 0, sd = sqrt(var.z1))
    z2 <- a * z1 + rnorm(n, 0, sd = sqrt(var.e0))
    y <- b1 * z1 + rnorm(n, 0, sd = sqrt(var.e1))
    
    z1.star <- (z1 - mean(z1)) / sd(z1)
    z2.star <- (z2 - mean(z2)) / sd(z2)
    y.star <- y # (y - mean(y)) # / sd(y)
    
    b1.hat <- c(b1.hat, sum(z1.star * y.star) / n)
    b2.hat <- c(b2.hat, sum(z2.star * y.star) / n)
    
  }
  hat.cor.b <- c(hat.cor.b, cor(b1.hat, b2.hat))
}
cor.g <- cor.z / 2
hist(hat.cor.b - cor.z)
```